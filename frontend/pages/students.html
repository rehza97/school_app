<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø§Ù„Ø·Ù„Ø§Ø¨ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“š</text></svg>"
    />
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/students.css" />
    <style>
      .reference-data-section {
        display: flex;
        gap: 1rem;
        margin: 1rem 0;
        flex-wrap: nowrap;
      }

      .reference-data-section .content-card {
        flex: 1;
        min-width: 300px;
        margin: 0;
      }

      .reference-data-section .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        flex-wrap: wrap;
      }

      .reference-data-section .table-wrapper {
        max-height: 300px;
        overflow-y: auto;
      }

      .reference-data-section .data-table {
        width: 100%;
        min-width: 250px;
      }

      @media screen and (max-width: 1200px) {
        .reference-data-section {
          flex-wrap: wrap;
        }

        .reference-data-section .content-card {
          flex: 1 1 calc(50% - 1rem);
        }
      }

      @media screen and (max-width: 768px) {
        .reference-data-section .content-card {
          flex: 1 1 100%;
        }
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- Add SheetJS library for Excel parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <!-- Firebase Config -->
    <script>
      // Current Firebase config (commented out)
      /*const firebaseConfig = {
        apiKey: "AIzaSyDb3WjlUPT4mHBaSp6RlBaj5bRH91WVSOM",
        projectId: "school-dba13",
        storageBucket: "school-dba13.firebasestorage.app",
        appId: "1:680944552420:android:270246e4fcc67b9c25dff1",
      };*/
      // Temporary Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyCq4l4Ppt60zXz_m46HbK6qchu7HBAbNMA",
        authDomain: "myschool-d8bbe.firebaseapp.com",
        projectId: "myschool-d8bbe",
        storageBucket: "myschool-d8bbe.firebasestorage.app",
        messagingSenderId: "888939871515",
        appId: "1:888939871515:web:7a7042a5a268fa9d79a7be",
        measurementId: "G-9SR1L1THQC",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Initialize collections
      const specialtiesRef = db.collection("specialties");
      const gradesRef = db.collection("grades");
      const classesRef = db.collection("classes");

      // Function to load specialties
      async function loadSpecialties() {
        try {
          const snapshot = await specialtiesRef.get();
          const select = document.getElementById("specialty");
          const filterSelect = document.getElementById("specialtyFilter");

          // Clear existing options except the first one
          select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>';
          filterSelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ®ØµØµØ§Øª</option>';

          snapshot.forEach((doc) => {
            const data = doc.data();
            const option = new Option(data.name, doc.id);
            const filterOption = new Option(data.name, doc.id);
            select.add(option);
            filterSelect.add(filterOption);
          });
        } catch (error) {
          console.error("Error loading specialties:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª", "error");
        }
      }

      // Function to load grades
      async function loadGrades() {
        try {
          const snapshot = await gradesRef.get();
          const select = document.getElementById("educationLevel");
          const filterSelect = document.getElementById("educationLevelFilter");

          // Clear existing options except the first one
          select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</option>';
          filterSelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</option>';

          snapshot.forEach((doc) => {
            const data = doc.data();
            const option = new Option(data.name, doc.id);
            const filterOption = new Option(data.name, doc.id);
            select.add(option);
            filterSelect.add(filterOption);
          });
        } catch (error) {
          console.error("Error loading grades:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©", "error");
        }
      }

      // Function to load classes
      async function loadClasses() {
        try {
          const snapshot = await classesRef.get();
          const select = document.getElementById("section");
          const filterSelect = document.getElementById("sectionFilter");

          // Clear existing options except the first one
          select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>';
          filterSelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>';

          snapshot.forEach((doc) => {
            const data = doc.data();
            const option = new Option(data.name, doc.id);
            const filterOption = new Option(data.name, doc.id);
            select.add(option);
            filterSelect.add(filterOption);
          });
        } catch (error) {
          console.error("Error loading classes:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…", "error");
        }
      }

      // Function to initialize reference data
      async function initializeReferenceData(excelData) {
        if (!excelData || !Array.isArray(excelData)) {
          console.log("No Excel data provided for reference initialization");
          return;
        }

        try {
          // Extract unique values from Excel data
          const specialties = [
            ...new Set(excelData.map((row) => row["Ø§Ù„Ø´Ø¹Ø¨Ø©"]).filter(Boolean)),
          ].map((name) => ({ name }));
          const grades = [
            ...new Set(excelData.map((row) => row["Ø§Ù„Ø³Ù†Ø©"]).filter(Boolean)),
          ].map((name) => ({ name }));
          const classes = [
            ...new Set(excelData.map((row) => row["Ø§Ù„Ù‚Ø³Ù…"]).filter(Boolean)),
          ].map((name) => ({ name }));

          console.log("Extracted reference data:", {
            specialties,
            grades,
            classes,
          });

          // Initialize specialties
          for (const specialty of specialties) {
            const snapshot = await specialtiesRef
              .where("name", "==", specialty.name)
              .get();
            if (snapshot.empty) {
              await specialtiesRef.add(specialty);
              console.log(`Added new specialty: ${specialty.name}`);
            }
          }

          // Initialize grades
          for (const grade of grades) {
            const snapshot = await gradesRef
              .where("name", "==", grade.name)
              .get();
            if (snapshot.empty) {
              await gradesRef.add(grade);
              console.log(`Added new grade: ${grade.name}`);
            }
          }

          // Initialize classes
          for (const cls of classes) {
            const snapshot = await classesRef
              .where("name", "==", cls.name)
              .get();
            if (snapshot.empty) {
              await classesRef.add(cls);
              console.log(`Added new class: ${cls.name}`);
            }
          }

          console.log(
            "Reference data initialized successfully from Excel data"
          );
        } catch (error) {
          console.error("Error initializing reference data:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ©", "error");
        }
      }

      // Check Firebase connection
      async function checkFirebaseConnection() {
        try {
          await db.collection("students").get();
          return true;
        } catch (error) {
          console.error("Firebase connection error:", error);
          return false;
        }
      }
    </script>
  </head>
  <body>
    <div class="container">
      <!-- Sidebar -->
      <nav class="sidebar">
        <div class="logo">
          <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</h2>
          <button
            id="themeToggle"
            class="theme-toggle"
            title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…"
          >
            <i class="fas fa-moon"></i>
          </button>
        </div>
        <ul class="nav-links">
          <li>
            <a href="../index.html"><i class="fas fa-home"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
          </li>
          <li class="active">
            <a href="students.html"
              ><i class="fas fa-user-graduate"></i> Ø§Ù„Ø·Ù„Ø§Ø¨</a
            >
          </li>
          <li>
            <a href="teachers.html"
              ><i class="fas fa-chalkboard-teacher"></i> Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ†</a
            >
          </li>
          <li>
            <a href="classes.html"><i class="fas fa-school"></i> Ø§Ù„ÙØµÙˆÙ„</a>
          </li>
          <li>
            <a href="attendance.html"
              ><i class="fas fa-calendar-check"></i> Ø§Ù„Ø­Ø¶ÙˆØ±</a
            >
          </li>
          <li>
            <a href="reports.html"><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
          </li>
          <li>
            <a href="settings.html"><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
          </li>
        </ul>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <header>
          <div class="header-content">
            <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
            <div class="user-info">
              <span class="user-name">Ø§Ù„Ù…Ø¯ÙŠØ±</span>
              <i class="fas fa-user-circle"></i>
            </div>
          </div>
        </header>

        <div class="students-container">
          <!-- Quick Stats -->
          <div class="stats-container">
            <div class="stat-card">
              <i class="fas fa-users"></i>
              <div class="stat-info">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                <p id="totalStudents">0</p>
              </div>
            </div>
            <div class="stat-card">
              <i class="fas fa-user-check"></i>
              <div class="stat-info">
                <h3>Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</h3>
                <p id="activeStudents">0</p>
              </div>
            </div>
            <div class="stat-card">
              <i class="fas fa-user-times"></i>
              <div class="stat-info">
                <h3>Ø§Ù„Ø·Ù„Ø§Ø¨ ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</h3>
                <p id="inactiveStudents">0</p>
              </div>
            </div>
          </div>

          <!-- Add this right after the Quick Stats section -->
          <div class="reference-data-section">
            <!-- Specialties Management -->
            <div class="content-card">
              <div class="card-header">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®ØµØµØ§Øª</h3>
                <button class="btn-primary" onclick="showAddSpecialtyModal()">
                  <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ
                </button>
              </div>
              <div class="table-wrapper">
                <table class="data-table" id="specialtiesTable">
                  <thead>
                    <tr>
                      <th>Ø§Ù„ØªØ®ØµØµ</th>
                      <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                  </thead>
                  <tbody id="specialtiesTableBody">
                    <!-- Specialties will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Grades Management -->
            <div class="content-card">
              <div class="card-header">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h3>
                <button class="btn-primary" onclick="showAddGradeModal()">
                  <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙˆÙ‰
                </button>
              </div>
              <div class="table-wrapper">
                <table class="data-table" id="gradesTable">
                  <thead>
                    <tr>
                      <th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
                      <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                  </thead>
                  <tbody id="gradesTableBody">
                    <!-- Grades will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Classes Management -->
            <div class="content-card">
              <div class="card-header">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
                <button class="btn-primary" onclick="showAddClassModal()">
                  <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…
                </button>
              </div>
              <div class="table-wrapper">
                <table class="data-table" id="classesTable">
                  <thead>
                    <tr>
                      <th>Ø§Ù„Ù‚Ø³Ù…</th>
                      <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                  </thead>
                  <tbody id="classesTableBody">
                    <!-- Classes will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Data Import Section -->
          <div class="content-card import-card">
            <div class="card-header">
              <h3>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
            </div>
            <div class="card-body">
              <p class="import-info">
                <i class="fas fa-info-circle"></i>
                ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ù† Ù…Ù„Ù Excel. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ù…Ù„Ù Ø¹Ù„Ù‰
                Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙØŒ Ø§Ù„Ù„Ù‚Ø¨ØŒ Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø¬Ù†Ø³ØŒ ØªØ§Ø±ÙŠØ®
                Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ØŒ Ø§Ù„Ù‚Ø³Ù…ØŒ Ø§Ù„Ø³Ù†Ø©ØŒ Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯ØŒ Ø±Ù‚Ù… Ø¹Ù‚Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ØŒ Ø¹Ù‚Ø¯
                Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ØŒ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¯Ø±ÙŠØ³ØŒ Ø§Ù„Ø´Ø¹Ø¨Ø©.
              </p>
              <div class="drag-drop-zone" id="studentDragDropZone">
                <div class="upload-container">
                  <div class="file-input-wrapper">
                    <i class="fas fa-user-graduate"></i>
                    <p>Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ù…Ù„Ù Ø§Ù„Ø·Ù„Ø§Ø¨ Ù‡Ù†Ø§ Ø£Ùˆ</p>
                    <label for="studentExcelFile" class="file-label">
                      <span>Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                    </label>
                    <input
                      type="file"
                      id="studentExcelFile"
                      accept=".xlsx, .xls"
                      title="Ø­Ø¯Ø¯ Ù…Ù„Ù Excel Ù„Ù„Ø·Ù„Ø§Ø¨"
                    />
                  </div>
                </div>
              </div>

              <!-- Excel Preview section -->
              <div id="excel-preview" class="excel-preview"></div>
            </div>
          </div>

          <!-- Preview Section -->
          <div
            class="content-card preview-card"
            id="previewSection"
            style="display: none"
          >
            <div class="card-header">
              <h3>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
              <div class="preview-controls">
                <span class="record-count"
                  >Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: <span id="recordCount">0</span></span
                >
                <div class="preview-buttons">
                  <button id="cancelBtn" class="btn-secondary">
                    <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                  </button>
                  <button id="uploadBtn" class="btn-primary">
                    <i class="fas fa-upload"></i> Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
                  </button>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div class="preview-table-wrapper">
                <table id="previewTable" class="preview-table">
                  <!-- Table content will be dynamically added here -->
                </table>
              </div>
            </div>
          </div>

          <!-- Search and Filter Section -->
          <div class="content-card">
            <div class="card-header">
              <div class="filters-section">
                <div class="search-box">
                  <input
                    type="text"
                    id="searchInput"
                    placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨..."
                  />
                  <i class="fas fa-search"></i>
                </div>
                <div class="filter-box">
                  <select
                    id="educationLevelFilter"
                    title="ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ"
                  >
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</option>
                    <!-- Education levels will be loaded dynamically -->
                  </select>
                  <select id="specialtyFilter" title="ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØªØ®ØµØµ">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ®ØµØµØ§Øª</option>
                    <!-- Specialties will be loaded dynamically -->
                  </select>
                  <select id="sectionFilter" title="ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                    <!-- Sections will be loaded dynamically -->
                  </select>
                  <select
                    id="educationSystemFilter"
                    title="ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ…Ø¯Ø±Ø³"
                  >
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØªÙ…Ø¯Ø±Ø³</option>
                    <!-- Education systems will be loaded dynamically -->
                  </select>
                  <select id="statusFilter" title="ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                    <option value="active">Ù†Ø´Ø·</option>
                    <option value="inactive">ØºÙŠØ± Ù†Ø´Ø·</option>
                  </select>
                </div>
                <button id="addStudentBtn" class="btn-primary">
                  <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨
                </button>
              </div>
            </div>

            <!-- Students Table -->
            <div class="table-wrapper">
              <table class="data-table" id="studentsTable">
                <thead>
                  <tr>
                    <th class="sortable" data-field="registration_id">
                      Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ <span class="sort-indicator"></span>
                    </th>
                    <th class="sortable" data-field="first_name">
                      Ø§Ù„Ø§Ø³Ù… <span class="sort-indicator"></span>
                    </th>
                    <th class="sortable" data-field="last_name">
                      Ø§Ù„Ù„Ù‚Ø¨ <span class="sort-indicator"></span>
                    </th>
                    <th class="sortable" data-field="gender">
                      Ø§Ù„Ø¬Ù†Ø³ <span class="sort-indicator"></span>
                    </th>
                    <th class="sortable" data-field="birth_date">
                      ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ <span class="sort-indicator"></span>
                    </th>
                    <th class="sortable" data-field="education_level_name">
                      Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ <span class="sort-indicator"></span>
                    </th>
                    <th class="sortable" data-field="specialty_name">
                      Ø§Ù„ØªØ®ØµØµ <span class="sort-indicator"></span>
                    </th>
                    <th class="sortable" data-field="section_name">
                      Ø§Ù„Ù‚Ø³Ù… <span class="sort-indicator"></span>
                    </th>
                    <th class="sortable" data-field="education_system_name">
                      Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ…Ø¯Ø±Ø³ <span class="sort-indicator"></span>
                    </th>
                    <th class="sortable" data-field="active">
                      Ø§Ù„Ø­Ø§Ù„Ø© <span class="sort-indicator"></span>
                    </th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                  </tr>
                </thead>
                <tbody id="studentsTableBody">
                  <!-- Table content will be dynamically added here -->
                </tbody>
              </table>
            </div>

            <!-- Pagination -->
            <div class="pagination">
              <button id="prevPage" class="btn-secondary">
                <i class="fas fa-chevron-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
              </button>
              <span class="page-info">
                ØµÙØ­Ø© <span id="currentPage">1</span> Ù…Ù†
                <span id="totalPages">1</span>
              </span>
              <button id="nextPage" class="btn-secondary">
                Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-chevron-left"></i>
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Add Student Modal -->
    <div id="studentModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalTitle">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</h2>
          <button class="close-btn" title="Ø¥ØºÙ„Ø§Ù‚">&times;</button>
        </div>
        <div class="modal-body">
          <form id="studentForm">
            <div class="form-grid">
              <!-- Basic Information -->
              <div class="form-section">
                <h3>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
                <div class="form-group">
                  <label for="studentId">Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ</label>
                  <input
                    type="text"
                    id="studentId"
                    name="registration_id"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="firstName">Ø§Ù„Ø§Ø³Ù…</label>
                  <input
                    type="text"
                    id="firstName"
                    name="first_name"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="lastName">Ø§Ù„Ù„Ù‚Ø¨</label>
                  <input type="text" id="lastName" name="last_name" required />
                </div>
                <div class="form-group">
                  <label for="gender">Ø§Ù„Ø¬Ù†Ø³</label>
                  <select id="gender" name="gender" required>
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
                    <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
                    <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="birthDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯</label>
                  <input
                    type="date"
                    id="birthDate"
                    name="birth_date"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="birthPlace">Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯</label>
                  <input type="text" id="birthPlace" name="birth_place" />
                </div>
              </div>

              <!-- Birth Certificate Information -->
              <div class="form-section">
                <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù‚Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</h3>
                <div class="form-group">
                  <label for="birthByJudgment">Ù…ÙˆÙ„ÙˆØ¯ Ø¨Ø­ÙƒÙ…</label>
                  <input
                    type="text"
                    id="birthByJudgment"
                    name="birth_by_judgment"
                  />
                </div>
                <div class="form-group">
                  <label for="birthCertificate">Ø¹Ù‚Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                  <input
                    type="text"
                    id="birthCertificate"
                    name="birth_certificate"
                  />
                </div>
                <div class="form-group">
                  <label for="birthRecordYear"
                    >Ø³Ù†Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„ÙˆÙ„Ø§Ø¯Ø§Øª</label
                  >
                  <input
                    type="text"
                    id="birthRecordYear"
                    name="birth_record_year"
                  />
                </div>
                <div class="form-group">
                  <label for="birthCertificateNumber">Ø±Ù‚Ù… Ø¹Ù‚Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                  <input
                    type="text"
                    id="birthCertificateNumber"
                    name="birth_certificate_number"
                  />
                </div>
              </div>

              <!-- Registration Information -->
              <div class="form-section">
                <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
                <div class="form-group">
                  <label for="registrationNumber">Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯</label>
                  <input
                    type="text"
                    id="registrationNumber"
                    name="registration_number"
                  />
                </div>
                <div class="form-group">
                  <label for="registrationDate">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label>
                  <input
                    type="date"
                    id="registrationDate"
                    name="registration_date"
                  />
                </div>
                <div class="form-group">
                  <label for="educationLevel">Ø§Ù„Ø³Ù†Ø© (Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ)</label>
                  <select id="educationLevel" name="education_level_id">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</option>
                    <!-- Education levels will be loaded dynamically -->
                  </select>
                </div>
                <div class="form-group">
                  <label for="specialty">Ø§Ù„Ø´Ø¹Ø¨Ø© (Ø§Ù„ØªØ®ØµØµ)</label>
                  <select id="specialty" name="specialty_id">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØ®ØµØµ</option>
                    <!-- Specialties will be loaded dynamically -->
                  </select>
                </div>
                <div class="form-group">
                  <label for="section">Ø§Ù„Ù‚Ø³Ù…</label>
                  <select id="section" name="section_id">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
                    <!-- Sections will be loaded dynamically -->
                  </select>
                </div>
                <div class="form-group">
                  <label for="educationSystem">Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ…Ø¯Ø±Ø³</label>
                  <select id="educationSystem" name="education_system_id">
                    <option value="">Ø§Ø®ØªØ± Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ…Ø¯Ø±Ø³</option>
                    <!-- Education systems will be loaded dynamically -->
                  </select>
                </div>
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn-secondary" id="cancelModalBtn">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button type="submit" class="btn-primary">Ø­ÙØ¸</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Export Button -->
    <button
      id="exportExcelBtn"
      class="btn-primary export-btn"
      title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"
    >
      <i class="fas fa-file-export"></i>
    </button>

    <!-- Add Modals -->
    <!-- Specialty Modal -->
    <div id="specialtyModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="specialtyModalTitle">Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ</h2>
          <button class="close-btn" onclick="closeModal('specialtyModal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="specialtyForm" onsubmit="handleSpecialtySubmit(event)">
            <div class="form-group">
              <label for="specialtyName">Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ</label>
              <input type="text" id="specialtyName" name="name" required />
              <input type="hidden" id="specialtyId" name="id" />
            </div>
            <div class="form-actions">
              <button
                type="button"
                class="btn-secondary"
                onclick="closeModal('specialtyModal')"
              >
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button type="submit" class="btn-primary">Ø­ÙØ¸</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Grade Modal -->
    <div id="gradeModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="gradeModalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙˆÙ‰ ØªØ¹Ù„ÙŠÙ…ÙŠ</h2>
          <button class="close-btn" onclick="closeModal('gradeModal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="gradeForm" onsubmit="handleGradeSubmit(event)">
            <div class="form-group">
              <label for="gradeName">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
              <input type="text" id="gradeName" name="name" required />
              <input type="hidden" id="gradeId" name="id" />
            </div>
            <div class="form-actions">
              <button
                type="button"
                class="btn-secondary"
                onclick="closeModal('gradeModal')"
              >
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button type="submit" class="btn-primary">Ø­ÙØ¸</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Class Modal -->
    <div id="classModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="classModalTitle">Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…</h2>
          <button class="close-btn" onclick="closeModal('classModal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="classForm" onsubmit="handleClassSubmit(event)">
            <div class="form-group">
              <label for="className">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø³Ù…</label>
              <input type="text" id="className" name="name" required />
              <input type="hidden" id="classId" name="id" />
            </div>
            <div class="form-actions">
              <button
                type="button"
                class="btn-secondary"
                onclick="closeModal('classModal')"
              >
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button type="submit" class="btn-primary">Ø­ÙØ¸</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Custom Scripts -->
    <!-- <script src="../js/students.js"></script> -->
    <script>
      let currentPage = 1;
      const pageSize = 10;
      let totalStudents = [];

      // Function to fetch and display student data
      async function fetchAndDisplayStudents() {
        try {
          console.log("Fetching student data from Firebase...");

          const isConnected = await checkFirebaseConnection();
          if (!isConnected) {
            showNotification("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase", "error");
            return;
          }

          const studentsRef = db.collection("students");
          const snapshot = await studentsRef.get();

          if (snapshot.empty) {
            console.log("No students found in database");
            updateStats(0, 0, 0);
            displayStudentsInTable([]);
            return;
          }

          totalStudents = [];
          let activeCount = 0;
          let inactiveCount = 0;

          // Fetch all reference data first
          const specialtiesSnapshot = await specialtiesRef.get();
          const gradesSnapshot = await gradesRef.get();
          const classesSnapshot = await classesRef.get();

          // Create maps for quick lookups
          const specialtiesMap = new Map();
          const gradesMap = new Map();
          const classesMap = new Map();

          specialtiesSnapshot.forEach((doc) =>
            specialtiesMap.set(doc.id, doc.data().name)
          );
          gradesSnapshot.forEach((doc) =>
            gradesMap.set(doc.id, doc.data().name)
          );
          classesSnapshot.forEach((doc) =>
            classesMap.set(doc.id, doc.data().name)
          );

          for (const doc of snapshot.docs) {
            const data = doc.data();

            // Get referenced data
            let specialtyName = "";
            let gradeName = "";
            let className = "";

            if (data.specialty_ref) {
              specialtyName = specialtiesMap.get(data.specialty_ref.id) || "";
            }
            if (data.grade_ref) {
              gradeName = gradesMap.get(data.grade_ref.id) || "";
            }
            if (data.class_ref) {
              className = classesMap.get(data.class_ref.id) || "";
            }

            const studentData = {
              id: doc.id,
              name: data.first_name || "",
              lastName: data.last_name || "",
              gender: data.gender || "",
              ØªØ§Ø±ÙŠØ®_Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯: data.birth_date || "",
              currentGrade: gradeName,
              specialty: specialtyName,
              className: className,
              Ù†Ø¸Ø§Ù…_Ø§Ù„ØªÙ…Ø¯Ø±Ø³: data.education_system || "",
              isActive: data.isActive ?? true,
              birthPlace: data.birth_place || "",
              birthCertificate: data.birth_certificate || "",
              birthCertificateNumber: data.birth_certificate_number || "",
              registrationDate: data.registration_date || "",
              Ø±Ù‚Ù…_Ø§Ù„Ù‚ÙŠØ¯: data.registration_number || "",
            };

            totalStudents.push(studentData);
            if (studentData.isActive) activeCount++;
            else inactiveCount++;
          }

          // Update stats
          updateStats(totalStudents.length, activeCount, inactiveCount);

          // Update table with pagination
          updateTableDisplay();

          console.log("Student data loaded and formatted successfully!");
        } catch (error) {
          console.error("Error fetching student data:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨", "error");
        }
      }

      // Function to update table display with pagination
      function updateTableDisplay() {
        const start = (currentPage - 1) * pageSize;
        const end = start + pageSize;
        const paginatedStudents = totalStudents.slice(start, end);

        displayStudentsInTable(paginatedStudents);
        updatePagination();
      }

      // Function to update pagination controls
      function updatePagination() {
        const totalPages = Math.ceil(totalStudents.length / pageSize);
        document.getElementById("currentPage").textContent = currentPage;
        document.getElementById("totalPages").textContent = totalPages;

        document.getElementById("prevPage").disabled = currentPage === 1;
        document.getElementById("nextPage").disabled =
          currentPage === totalPages;
      }

      // Function to handle file upload and preview
      async function handleFileUpload(file) {
        try {
          console.log("Processing Excel file:", file.name);
          const reader = new FileReader();

          reader.onload = async function (e) {
            try {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, {
                type: "array",
                cellDates: true,
              });
              const firstSheet = workbook.Sheets[workbook.SheetNames[0]];

              // Convert to JSON with header row mapping
              const jsonData = XLSX.utils.sheet_to_json(firstSheet, {
                raw: false,
                dateNF: "yyyy-mm-dd",
                defval: "",
              });

              if (jsonData.length === 0) {
                throw new Error("Ø§Ù„Ù…Ù„Ù Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª");
              }

              // Get headers from first row
              const headers = Object.keys(jsonData[0]);

              // Store data for later upload
              window.excelData = jsonData;
              window.excelHeaders = headers;

              // Initialize reference data from Excel
              await initializeReferenceData(jsonData);

              // Reload reference data in dropdowns
              await Promise.all([
                loadSpecialties(),
                loadGrades(),
                loadClasses(),
                loadSpecialtiesTable(),
                loadGradesTable(),
                loadClassesTable(),
              ]);

              // Show preview
              showPreview(headers, jsonData);

              // Show success message
              showNotification(
                "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù ÙˆØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­",
                "success"
              );

              console.log("Excel data processed successfully:", {
                headers,
                rowCount: jsonData.length,
              });
            } catch (error) {
              console.error("Error processing Excel content:", error);
              showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù", "error");
            }
          };

          reader.onerror = function () {
            console.error("Error reading file");
            showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù", "error");
          };

          reader.readAsArrayBuffer(file);
        } catch (error) {
          console.error("Error processing Excel file:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù", "error");
        }
      }

      // Function to show preview
      function showPreview(headers, data) {
        const previewSection = document.getElementById("previewSection");
        const previewTable = document.getElementById("previewTable");
        const recordCount = document.getElementById("recordCount");

        recordCount.textContent = data.length;

        let tableHTML = "<thead><tr>";
        headers.forEach((header) => {
          tableHTML += `<th>${header}</th>`;
        });
        tableHTML += "</tr></thead><tbody>";

        // Show first 5 rows
        data.slice(0, 5).forEach((row) => {
          tableHTML += "<tr>";
          headers.forEach((header) => {
            tableHTML += `<td>${row[header] || ""}</td>`;
          });
          tableHTML += "</tr>";
        });

        tableHTML += "</tbody>";
        previewTable.innerHTML = tableHTML;
        previewSection.style.display = "block";
      }

      // Function to upload data to Firebase
      async function uploadToFirebase(data) {
        try {
          console.log("Starting Firebase upload with", data.length, "records");

          const batch = db.batch();
          const studentsRef = db.collection("students");

          let successCount = 0;
          let errorCount = 0;
          let updateCount = 0;

          for (const row of data) {
            try {
              // Get references to related data
              let specialtyRef = null;
              let gradeRef = null;
              let classRef = null;

              // Find specialty reference
              const specialtySnapshot = await specialtiesRef
                .where("name", "==", row["Ø§Ù„Ø´Ø¹Ø¨Ø©"])
                .get();
              if (!specialtySnapshot.empty) {
                specialtyRef = specialtySnapshot.docs[0].ref;
              }

              // Find grade reference
              const gradeSnapshot = await gradesRef
                .where("name", "==", row["Ø§Ù„Ø³Ù†Ø©"])
                .get();
              if (!gradeSnapshot.empty) {
                gradeRef = gradeSnapshot.docs[0].ref;
              }

              // Find class reference
              const classSnapshot = await classesRef
                .where("name", "==", row["Ø§Ù„Ù‚Ø³Ù…"])
                .get();
              if (!classSnapshot.empty) {
                classRef = classSnapshot.docs[0].ref;
              }

              const studentData = {
                registration_id: (row["Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ"] || "").toString().trim(),
                last_name: (row["Ø§Ù„Ù„Ù‚Ø¨"] || "").trim(),
                first_name: (row["Ø§Ù„Ø§Ø³Ù…"] || "").trim(),
                gender: (row["Ø§Ù„Ø¬Ù†Ø³"] || "").trim(),
                birth_date: row["ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯"] || "",
                birth_by_judgment: (row["Ù…ÙˆÙ„ÙˆØ¯ Ø¨Ø­ÙƒÙ…"] || "").trim(),
                birth_certificate: (row["Ø¹Ù‚Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯"] || "").trim(),
                birth_record_year: (
                  row["Ø³Ù†Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„ÙˆÙ„Ø§Ø¯Ø§Øª"] || ""
                ).trim(),
                birth_certificate_number: (row["Ø±Ù‚Ù… Ø¹Ù‚Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯"] || "")
                  .toString()
                  .trim(),
                birth_place: (row["Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯"] || "").trim(),
                specialty_ref: specialtyRef,
                grade_ref: gradeRef,
                class_ref: classRef,
                education_system: (row["Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ…Ø¯Ø±Ø³"] || "").trim(),
                registration_number: (row["Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯"] || "").toString().trim(),
                registration_date:
                  row["ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„"] || new Date().toISOString(),
                isActive: true,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
              };

              if (!studentData.registration_id) {
                console.warn(
                  "Skipping invalid record - missing registration ID"
                );
                errorCount++;
                continue;
              }

              const docRef = studentsRef.doc(studentData.registration_id);
              const doc = await docRef.get();

              if (doc.exists) {
                batch.update(docRef, {
                  ...studentData,
                  updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                });
                updateCount++;
              } else {
                batch.set(docRef, studentData);
                successCount++;
              }
            } catch (error) {
              console.error("Error processing row:", error);
              errorCount++;
            }

            // Commit batch every 500 records
            if ((successCount + updateCount) % 500 === 0) {
              await batch.commit();
              batch = db.batch();
            }
          }

          // Commit remaining records
          if ((successCount + updateCount) % 500 !== 0) {
            await batch.commit();
          }

          showNotification(
            `ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­: ${successCount} Ø¬Ø¯ÙŠØ¯ØŒ ${updateCount} ØªØ­Ø¯ÙŠØ«ØŒ ${errorCount} Ø®Ø·Ø£`,
            errorCount > 0 ? "warning" : "success"
          );

          // Refresh display
          await fetchAndDisplayStudents();

          // Hide preview section
          document.getElementById("previewSection").style.display = "none";
        } catch (error) {
          console.error("Error uploading to Firebase:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
        }
      }

      // Function to display students in table
      function displayStudentsInTable(students) {
        const tableBody = document.getElementById("studentsTableBody");
        if (!tableBody) return;

        if (students.length === 0) {
          tableBody.innerHTML =
            '<tr><td colspan="11" class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
          return;
        }

        // Function to convert Excel date number to readable date
        function excelDateToJSDate(excelDate) {
          if (!excelDate) return "";
          // Excel dates are number of days since 1900-01-01
          const date = new Date(
            (excelDate - 1) * 24 * 60 * 60 * 1000 +
              new Date("1900-01-01").getTime()
          );
          return date.toLocaleDateString("ar-SA");
        }

        tableBody.innerHTML = students
          .map(
            (student) => `
            <tr>
              <td>${student.id || ""}</td>
              <td>${student.name || ""}</td>
              <td>${student.lastName || ""}</td>
              <td>${student.gender || ""}</td>
              <td>${excelDateToJSDate(
                student.ØªØ§Ø±ÙŠØ®_Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯ || student["ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯"]
              )}</td>
              <td>${student.currentGrade || ""}</td>
              <td>${student.specialty || ""}</td>
              <td>${student.className || ""}</td>
              <td>${student.Ù†Ø¸Ø§Ù…_Ø§Ù„ØªÙ…Ø¯Ø±Ø³ || student["Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ…Ø¯Ø±Ø³"] || ""}</td>
              <td>
                <span class="status-badge ${
                  student.isActive ? "active" : "inactive"
                }">
                  ${student.isActive ? "Ù†Ø´Ø·" : "ØºÙŠØ± Ù†Ø´Ø·"}
                </span>
              </td>
              <td class="actions-cell">
                <button class="action-btn edit" onclick="editStudent('${
                  student.id
                }')" title="ØªØ¹Ø¯ÙŠÙ„">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn view" onclick="viewStudent('${
                  student.id
                }')" title="Ø¹Ø±Ø¶">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="action-btn delete" onclick="deleteStudent('${
                  student.id
                }')" title="Ø­Ø°Ù">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          `
          )
          .join("");
      }

      // Add these styles to your CSS
      const style = document.createElement("style");
      style.textContent = `
        .status-badge {
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 0.9em;
          font-weight: 500;
        }
        .status-badge.active {
          background-color: #e3f2fd;
          color: #1976d2;
        }
        .status-badge.inactive {
          background-color: #ffebee;
          color: #d32f2f;
        }
        .actions-cell {
          display: flex;
          gap: 8px;
          justify-content: center;
        }
        .action-btn {
          padding: 6px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          transition: background-color 0.2s;
        }
        .action-btn:hover {
          background-color: #f5f5f5;
        }
        .action-btn.edit {
          color: #1976d2;
        }
        .action-btn.view {
          color: #388e3c;
        }
        .action-btn.delete {
          color: #d32f2f;
        }
      `;
      document.head.appendChild(style);

      // Function to edit student
      async function editStudent(id) {
        try {
          const doc = await db.collection("students").doc(id).get();
          if (doc.exists) {
            const student = doc.data();

            // Fill the form with student data
            const form = document.getElementById("studentForm");
            form.registration_id.value = id;
            form.first_name.value = student.first_name || "";
            form.last_name.value = student.last_name || "";
            form.gender.value = student.gender || "";
            form.birth_date.value = student.birth_date || "";
            form.birth_place.value = student.birth_place || "";
            form.birth_by_judgment.value = student.birth_by_judgment || "";
            form.birth_certificate.value = student.birth_certificate || "";
            form.birth_record_year.value = student.birth_record_year || "";
            form.birth_certificate_number.value =
              student.birth_certificate_number || "";
            form.registration_number.value = student.registration_number || "";
            form.registration_date.value = student.registration_date
              ? new Date(student.registration_date).toISOString().split("T")[0]
              : "";

            // Handle references
            if (student.specialty_ref) {
              form.specialty_id.value = student.specialty_ref.id;
            }
            if (student.grade_ref) {
              form.education_level_id.value = student.grade_ref.id;
            }
            if (student.class_ref) {
              form.section_id.value = student.class_ref.id;
            }
            if (student.education_system) {
              form.education_system_id.value = student.education_system;
            }

            // Show modal
            document.getElementById("studentModal").style.display = "block";
            document.getElementById("modalTitle").textContent =
              "ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨";
          }
        } catch (error) {
          console.error("Error loading student data:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨", "error");
        }
      }

      // Function to view student
      async function viewStudent(id) {
        try {
          const doc = await db.collection("students").doc(id).get();
          if (doc.exists) {
            // Redirect to student profile page
            window.location.href = `student-profile.html?id=${id}`;
          }
        } catch (error) {
          console.error("Error loading student data:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨", "error");
        }
      }

      // Function to delete student
      async function deleteStudent(id) {
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ")) {
          try {
            await db.collection("students").doc(id).delete();
            showNotification("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­", "success");
            fetchAndDisplayStudents(); // Refresh the table
          } catch (error) {
            console.error("Error deleting student:", error);
            showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨", "error");
          }
        }
      }

      // Event Listeners
      document.addEventListener("DOMContentLoaded", async () => {
        // Load existing reference data into dropdowns
        await Promise.all([
          loadSpecialties(),
          loadGrades(),
          loadClasses(),
          loadSpecialtiesTable(),
          loadGradesTable(),
          loadClassesTable(),
        ]);

        fetchAndDisplayStudents();

        // File input change handler
        document
          .getElementById("studentExcelFile")
          .addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file) handleFileUpload(file);
          });

        // Upload button click handler
        document.getElementById("uploadBtn").addEventListener("click", () => {
          if (window.excelData) {
            uploadToFirebase(window.excelData);
          } else {
            showNotification("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø±ÙØ¹", "error");
          }
        });

        // Cancel button click handler
        document.getElementById("cancelBtn").addEventListener("click", () => {
          document.getElementById("previewSection").style.display = "none";
          window.excelData = null;
          window.excelHeaders = null;
        });

        // Search input handler
        document
          .getElementById("searchInput")
          .addEventListener("input", (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll("#studentsTableBody tr");

            rows.forEach((row) => {
              const text = row.textContent.toLowerCase();
              row.style.display = text.includes(searchTerm) ? "" : "none";
            });
          });

        // Pagination event listeners
        document.getElementById("prevPage").addEventListener("click", () => {
          if (currentPage > 1) {
            currentPage--;
            updateTableDisplay();
          }
        });

        document.getElementById("nextPage").addEventListener("click", () => {
          const totalPages = Math.ceil(totalStudents.length / pageSize);
          if (currentPage < totalPages) {
            currentPage++;
            updateTableDisplay();
          }
        });

        // Add Student button click handler
        document
          .getElementById("addStudentBtn")
          .addEventListener("click", () => {
            // Reset form
            document.getElementById("studentForm").reset();
            document.getElementById("modalTitle").textContent = "Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨";
            document.getElementById("studentModal").style.display = "block";
          });

        // Close modal button handler
        document
          .querySelector("#studentModal .close-btn")
          .addEventListener("click", () => {
            document.getElementById("studentModal").style.display = "none";
          });

        // Cancel button handler
        document
          .getElementById("cancelModalBtn")
          .addEventListener("click", () => {
            document.getElementById("studentModal").style.display = "none";
          });

        // Form submit handler
        document
          .getElementById("studentForm")
          .addEventListener("submit", async (e) => {
            e.preventDefault();
            const form = e.target;

            try {
              const studentData = {
                registration_id: form.registration_id.value.trim(),
                first_name: form.first_name.value.trim(),
                last_name: form.last_name.value.trim(),
                gender: form.gender.value,
                birth_date: form.birth_date.value,
                birth_place: form.birth_place.value.trim(),
                birth_by_judgment: form.birth_by_judgment.value.trim(),
                birth_certificate: form.birth_certificate.value.trim(),
                birth_record_year: form.birth_record_year.value.trim(),
                birth_certificate_number:
                  form.birth_certificate_number.value.trim(),
                registration_number: form.registration_number.value.trim(),
                registration_date:
                  form.registration_date.value || new Date().toISOString(),
                isActive: true,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
              };

              // Get references to related data
              if (form.specialty_id.value) {
                studentData.specialty_ref = db.doc(
                  `specialties/${form.specialty_id.value}`
                );
              }
              if (form.education_level_id.value) {
                studentData.grade_ref = db.doc(
                  `grades/${form.education_level_id.value}`
                );
              }
              if (form.section_id.value) {
                studentData.class_ref = db.doc(
                  `classes/${form.section_id.value}`
                );
              }
              if (form.education_system_id.value) {
                studentData.education_system = form.education_system_id.value;
              }

              const studentsRef = db.collection("students");

              if (!studentData.registration_id) {
                throw new Error("Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ù…Ø·Ù„ÙˆØ¨");
              }

              const docRef = studentsRef.doc(studentData.registration_id);
              const doc = await docRef.get();

              if (doc.exists) {
                // Update existing student
                await docRef.update(studentData);
                showNotification("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­", "success");
              } else {
                // Add new student
                studentData.createdAt =
                  firebase.firestore.FieldValue.serverTimestamp();
                await docRef.set(studentData);
                showNotification("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­", "success");
              }

              // Close modal and refresh table
              document.getElementById("studentModal").style.display = "none";
              await fetchAndDisplayStudents();
            } catch (error) {
              console.error("Error saving student:", error);
              showNotification(
                error.message || "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨",
                "error"
              );
            }
          });
      });

      // Helper Functions
      function showNotification(message, type = "info") {
        const container = document.getElementById("notificationContainer");
        if (!container) return;

        const notification = document.createElement("div");
        notification.className = `notification ${type}`;

        const icon =
          type === "success"
            ? "check-circle"
            : type === "error"
            ? "exclamation-circle"
            : type === "warning"
            ? "exclamation-triangle"
            : "info-circle";

        notification.innerHTML = `
          <i class="fas fa-${icon}"></i>
          <span>${message}</span>
        `;

        container.appendChild(notification);

        setTimeout(() => {
          notification.classList.add("fade-out");
          setTimeout(() => notification.remove(), 300);
        }, 5000);
      }

      function updateStats(total, active, inactive) {
        document.getElementById("totalStudents").textContent = total;
        document.getElementById("activeStudents").textContent = active;
        document.getElementById("inactiveStudents").textContent = inactive;
      }

      // Add these functions after your existing JavaScript code

      // Function to load specialties table
      async function loadSpecialtiesTable() {
        try {
          const snapshot = await specialtiesRef.get();
          const tbody = document.getElementById("specialtiesTableBody");
          tbody.innerHTML = "";

          snapshot.forEach((doc) => {
            const data = doc.data();
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${data.name}</td>
              <td class="actions-cell">
                <button class="action-btn edit" onclick="editSpecialty('${doc.id}', '${data.name}')" title="ØªØ¹Ø¯ÙŠÙ„">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn delete" onclick="deleteSpecialty('${doc.id}')" title="Ø­Ø°Ù">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            `;
            tbody.appendChild(row);
          });
        } catch (error) {
          console.error("Error loading specialties:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª", "error");
        }
      }

      // Function to load grades table
      async function loadGradesTable() {
        try {
          const snapshot = await gradesRef.get();
          const tbody = document.getElementById("gradesTableBody");
          tbody.innerHTML = "";

          snapshot.forEach((doc) => {
            const data = doc.data();
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${data.name}</td>
              <td class="actions-cell">
                <button class="action-btn edit" onclick="editGrade('${doc.id}', '${data.name}')" title="ØªØ¹Ø¯ÙŠÙ„">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn delete" onclick="deleteGrade('${doc.id}')" title="Ø­Ø°Ù">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            `;
            tbody.appendChild(row);
          });
        } catch (error) {
          console.error("Error loading grades:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª", "error");
        }
      }

      // Function to load classes table
      async function loadClassesTable() {
        try {
          const snapshot = await classesRef.get();
          const tbody = document.getElementById("classesTableBody");
          tbody.innerHTML = "";

          snapshot.forEach((doc) => {
            const data = doc.data();
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${data.name}</td>
              <td class="actions-cell">
                <button class="action-btn edit" onclick="editClass('${doc.id}', '${data.name}')" title="ØªØ¹Ø¯ÙŠÙ„">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn delete" onclick="deleteClass('${doc.id}')" title="Ø­Ø°Ù">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            `;
            tbody.appendChild(row);
          });
        } catch (error) {
          console.error("Error loading classes:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…", "error");
        }
      }

      // Modal functions
      function showModal(modalId) {
        document.getElementById(modalId).style.display = "block";
      }

      function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
        // Clear form
        document.getElementById(modalId.replace("Modal", "Form")).reset();
        document.getElementById(modalId.replace("Modal", "Id")).value = "";
      }

      // Specialty CRUD operations
      function showAddSpecialtyModal() {
        document.getElementById("specialtyModalTitle").textContent =
          "Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ";
        document.getElementById("specialtyId").value = "";
        showModal("specialtyModal");
      }

      function editSpecialty(id, name) {
        document.getElementById("specialtyModalTitle").textContent =
          "ØªØ¹Ø¯ÙŠÙ„ ØªØ®ØµØµ";
        document.getElementById("specialtyId").value = id;
        document.getElementById("specialtyName").value = name;
        showModal("specialtyModal");
      }

      async function deleteSpecialty(id) {
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµØŸ")) {
          try {
            await specialtiesRef.doc(id).delete();
            showNotification("ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­", "success");
            await Promise.all([loadSpecialtiesTable(), loadSpecialties()]);
          } catch (error) {
            console.error("Error deleting specialty:", error);
            showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ØªØ®ØµØµ", "error");
          }
        }
      }

      async function handleSpecialtySubmit(event) {
        event.preventDefault();
        const form = event.target;
        const id = form.id.value;
        const name = form.name.value;

        try {
          if (id) {
            await specialtiesRef.doc(id).update({ name });
            showNotification("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­", "success");
          } else {
            await specialtiesRef.add({ name });
            showNotification("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­", "success");
          }
          closeModal("specialtyModal");
          await Promise.all([loadSpecialtiesTable(), loadSpecialties()]);
        } catch (error) {
          console.error("Error saving specialty:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ØªØ®ØµØµ", "error");
        }
      }

      // Grade CRUD operations
      function showAddGradeModal() {
        document.getElementById("gradeModalTitle").textContent =
          "Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙˆÙ‰ ØªØ¹Ù„ÙŠÙ…ÙŠ";
        document.getElementById("gradeId").value = "";
        showModal("gradeModal");
      }

      function editGrade(id, name) {
        document.getElementById("gradeModalTitle").textContent =
          "ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªÙˆÙ‰ ØªØ¹Ù„ÙŠÙ…ÙŠ";
        document.getElementById("gradeId").value = id;
        document.getElementById("gradeName").value = name;
        showModal("gradeModal");
      }

      async function deleteGrade(id) {
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ØŸ")) {
          try {
            await gradesRef.doc(id).delete();
            showNotification("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­", "success");
            await Promise.all([loadGradesTable(), loadGrades()]);
          } catch (error) {
            console.error("Error deleting grade:", error);
            showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙˆÙ‰", "error");
          }
        }
      }

      async function handleGradeSubmit(event) {
        event.preventDefault();
        const form = event.target;
        const id = form.id.value;
        const name = form.name.value;

        try {
          if (id) {
            await gradesRef.doc(id).update({ name });
            showNotification("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­", "success");
          } else {
            await gradesRef.add({ name });
            showNotification("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­", "success");
          }
          closeModal("gradeModal");
          await Promise.all([loadGradesTable(), loadGrades()]);
        } catch (error) {
          console.error("Error saving grade:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªÙˆÙ‰", "error");
        }
      }

      // Class CRUD operations
      function showAddClassModal() {
        document.getElementById("classModalTitle").textContent = "Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…";
        document.getElementById("classId").value = "";
        showModal("classModal");
      }

      function editClass(id, name) {
        document.getElementById("classModalTitle").textContent = "ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø³Ù…";
        document.getElementById("classId").value = id;
        document.getElementById("className").value = name;
        showModal("classModal");
      }

      async function deleteClass(id) {
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŸ")) {
          try {
            await classesRef.doc(id).delete();
            showNotification("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­", "success");
            await Promise.all([loadClassesTable(), loadClasses()]);
          } catch (error) {
            console.error("Error deleting class:", error);
            showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù‚Ø³Ù…", "error");
          }
        }
      }

      async function handleClassSubmit(event) {
        event.preventDefault();
        const form = event.target;
        const id = form.id.value;
        const name = form.name.value;

        try {
          if (id) {
            await classesRef.doc(id).update({ name });
            showNotification("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­", "success");
          } else {
            await classesRef.add({ name });
            showNotification("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­", "success");
          }
          closeModal("classModal");
          await Promise.all([loadClassesTable(), loadClasses()]);
        } catch (error) {
          console.error("Error saving class:", error);
          showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù‚Ø³Ù…", "error");
        }
      }

      // Add education system options
      const educationSystemSelect = document.getElementById("educationSystem");
      educationSystemSelect.innerHTML = `
        <option value="">Ø§Ø®ØªØ± Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ…Ø¯Ø±Ø³</option>
        <option value="Ø®Ø§Ø±Ø¬ÙŠ">Ø®Ø§Ø±Ø¬ÙŠ</option>
        <option value="Ù†ØµÙ Ø¯Ø§Ø®Ù„ÙŠ">Ù†ØµÙ Ø¯Ø§Ø®Ù„ÙŠ</option>
        <option value="Ø¯Ø§Ø®Ù„ÙŠ">Ø¯Ø§Ø®Ù„ÙŠ</option>
      `;
    </script>
  </body>
</html>
